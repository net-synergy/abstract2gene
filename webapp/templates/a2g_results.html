<html>
  <head>
    <title>A2G Search</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <table class="table">
      <tr>
        <td>
          <div style="margin-right: 60px">
            <h3 style="margin-left: 0">{{ action_title }}</h3>
            <h4>{{ parent.title }}</h4>
            <p>
              Genes: {% for i in range(parent.genes["symbol"]|length) %}
	      <a href="https://www.ncbi.nlm.nih.gov/gene/{{ parent.genes['entrez_id'][i] }}">
		{{ parent.genes['symbol'][i] }} ({{ parent.genes['prediction'][i] }})
	      </a>
	      {% if (i + 1) < parent.genes["symbol"]|length %}, {% endif %}
	      {% endfor %}
            </p>
            <br />
            <p>{{ parent.abstract }}</p>
          </div>
          <a href="/" role="button" class="btn btn-primary btn-return-home"
            >New search</a
          >
        </td>
      </tr>
    </table>
    <table class="table">
      <thead>
        <tr>
          <th scope="col">Article</th>
          <th scope="col">Similarity</th>
        </tr>
      </thead>
      <tbody>
        {% for result in results %}
        <tr>
          <td>
            <h4>{{ result.title }}</h4>
            <p>
	      Year: {{ result.year }}<br />
	      Genes: {% for i in range(result.genes["symbol"]|length) %}
	      <a href="https://www.ncbi.nlm.nih.gov/gene/{{ result.genes['entrez_id'][i] }}">
		{{ result.genes['symbol'][i] }} ({{ result.genes['prediction'][i] }})
	      </a>
	      {% if (i + 1) < result.genes["symbol"]|length %}, {% endif %}
	      {% endfor %}
            </p>
            <br />
            <p>{{ result.abstract }}</p>
            <a
              href="/results/pmid_search?positives={{ result.pmid }}&year_min={{ year_range.min_year }}&year_max={{ year_range.max_year }}"
              role="button"
              class="btn btn-primary btn-return-home"
              >Search</a
            >
            {% if result.reference > 0 %}
            <a
              href="/analyze/{{ result.pmid }}"
              role="button"
              class="btn btn-primary btn-return-home"
              >Analyze references ({{ result.reference }})</a
            >
            {% endif %}
            <a
              href="https://pubmed.ncbi.nlm.nih.gov/{{ result.pmid }}"
              role="botton"
              class="btn btn-primary btn-return-home"
              >PubMed {{result.pmid}}</a
            >
          </td>
          <td>{{ "{:.2f}".format(result.similarity) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div style="margin-top: 20px; margin-bottom: 20px; display: flex; justify-content: center; gap: 10px; ">
      {% if session_id %}
	{% set base_url = request.url_for("user_input", session_id=session_id) %}
	{% set positives = "" %}
	{% set negatives = "" %}
      {% else %}
	{% set base_url = request.url_for("pmid_search") %}
	{% set positives = "&positives=" ~ (request.query_params['positives'] | string) %}
	{% set negatives = "&negatives=" ~ (request.query_params['negatives'] | string) %}
      {% endif %}
      {% if page > 2 %}
	<a href="{{ base_url }}?year_min={{ request.query_params['year_min'] }}&year_max={{ request.query_params['year_max'] }}{{ positives }}{{ negatives }}" class="btn btn-primary">First</a>
      {% endif %}
      {% if page > 1 %}
	<a href="{{ base_url }}?year_min={{ request.query_params['year_min'] }}&year_max={{ request.query_params['year_max'] }}{{ positives }}{{ negatives }}&page={{ page - 1 }}" class="btn btn-primary">Prev</a>
      {% endif %}
      <h3 style="margin-left: 0px;">{{ page }}</h3>
      {% if not last_page %}
	<a href="{{ base_url }}?year_min={{ request.query_params['year_min'] }}&year_max={{ request.query_params['year_max'] }}{{ positives }}{{ negatives }}&page={{ page + 1 }}" class="btn btn-primary">Next</a>
      {% endif %}
    </div>
  </body>
</html>
